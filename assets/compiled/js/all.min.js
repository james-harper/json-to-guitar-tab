"use strict";var _slicedToArray=function(){function r(r,n){var a=[],t=!0,e=!1,o=void 0;try{for(var s,i=r[Symbol.iterator]();!(t=(s=i.next()).done)&&(a.push(s.value),!n||a.length!==n);t=!0);}catch(r){e=!0,o=r}finally{try{!t&&i.return&&i.return()}finally{if(e)throw o}}return a}return function(n,a){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return r(n,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),supportedChords=["major","minor","dim","5","7","maj7","min7"],strings={e:"e",B:"B",G:"G",D:"D",A:"A",E:"E"},constants={BEATS_PER_BAR:4},Bar={};Bar.draw=function(r,n,a,t){a=Pattern.fitToBar(a);var e="-",o="";t%constants.BEATS_PER_BAR==0&&(o+=n+"|");for(var s=1,i=0,d=0;d<a.length;d++){d>=Math.ceil(a.length/r.length)*s&&(i++,s++);var c=r[i];switch(n){case strings.e:e=c[5];break;case strings.B:e=c[4];break;case strings.G:e=c[3];break;case strings.D:e=c[2];break;case strings.A:e=c[1];break;case strings.E:e=c[0]}["x","X","-"].includes(e)||(e=parseInt("0x"+e,16)),Note.isValid(e)||(e="-"),e>=10&&"-"!==a[d-1]&&void 0!==a[d-1]||(o+="-"!==a[d]?e:"-")}return o+="|"};var Chord={};Chord.findByShape=function(r){var n="?";return _(chordMap).each(function(a,t){_(a).each(function(a,e){a.length&&_(a).each(function(a){if(a===r)return n=t+" "+e})})}),n},Chord.findByName=function(r){var n=void 0,a=void 0;if(r=r.replace(/\s/g,"_").toLowerCase(),_(supportedChords).each(function(t){r.includes(t)&&(r=r.replace("_",""),n=r.split(t)[0],a=t)}),!n&&!a){var t=r.split("_"),e=_slicedToArray(t,2);n=e[0],a=e[1]}return void 0===a&&(a="major"),n=Note.convertAccidental(n),chordMap[_.capitalize(n)][a]},Chord.isNamed=function(r){var n=!1;return supportedChords.forEach(function(a){1===a.length&&(a=" "+a),r.includes(a)&&(n=!0)}),n},Chord.find=function(r){if(Chord.isNamed(r)){var n=Chord.findByName(r);return n.length?_.sample(n):"?"}return Chord.findByShape(r)};var Note={};Note.FLAT="b",Note.SHARP="#",Note.convertAccidental=function(r){if(1===r.length)return _.toUpper(r);var n=_.toUpper(r.charAt(0));return r.charAt(1)===Note.SHARP&&(r=(n=String.fromCharCode(n.charCodeAt()+1))<"H"?n:"A",["C","F"].includes(r)||(r+=Note.FLAT)),r},Note.isValid=function(r){return"x"===r||"X"===r||("-"===r||!isNaN(r)&&(!!_.isNumber(r)||!!["a","b","c","d","e","f"].includes(r.toLowerCase())))};var Pattern={};Pattern.desiredLength=4*constants.BEATS_PER_BAR,Pattern.fitToBar=function(r){if(r.length<1&&(r="-"),(r=_.repeat(r,Pattern.desiredLength/r.length)).length<Pattern.desiredLength){var n=Pattern.desiredLength-r.length;r+=r.substring(0,n)}else r=r.substring(0,Pattern.desiredLength);return r},Pattern.random=function(){for(var r="x",n=0;n<Pattern.desiredLength-1;n++)r+=_.random(1)>0?"x":"-";return r};var chordMap={A:{major:["-02220","577655"],minor:["-02210","577555","-0a9a0"],5:["577---","-022--"],7:["-02020","-02023","575655"],maj7:["-02120","5x665x"],min7:["-02013","575555","-02010"],dim:[]},Bb:{major:["-13331","688766"],minor:["-13321","688666"],5:["688---","-133--"],7:["-13131","686766"],maj7:["-13231","6x776x"],min7:["-13121","686666"],dim:[]},B:{major:["-24442","799877"],minor:["799777","-24432"],5:["799---","-244--"],7:["-21202","-24242","797877"],maj7:["-24342","7x887x"],min7:["-24232","797777"],dim:[]},C:{major:["-32010","-32013","-35553"],minor:["-35543","8aa888"],5:["8aa---","-355--"],7:["-35353","8a8988"],maj7:["-35453","8x998x"],min7:["-35343"],dim:[]},Db:{major:["-46664","9bba99"],minor:["-46654","9bb999"],5:["-466--"],7:["-46464","9b9a99"],maj7:["-46564"],min7:["-46454"],dim:[]},D:{major:["--0232","-57775"],minor:["--0231","-57765","accaaa"],5:["-577--","--023-"],7:["--0212","-57575"],maj7:["--0222","-57675"],min7:["--0211","-57565"],dim:[]},Eb:{major:["-68886"],minor:["-68876"],5:["-688--"],7:["-68686"],maj7:["-68786"],min7:["-68676"],dim:[]},E:{major:["022100","-79997","076---"],minor:["022000","-79987","022003"],5:["022---","-799--","079---"],7:["020130","-79797"],maj7:["-79897"],min7:["022030","-79787"],dim:[]},F:{major:["133211","-8aaa8"],minor:["133111","-8aa98"],5:["133---"],7:["131211","-8a8a8"],maj7:["-8a9a8"],min7:["-8a898"],dim:[]},Gb:{major:["244322","-9bbb9"],minor:["244222","-9bba9"],5:["244---"],7:["242322","-9b9b9"],maj7:["-9bab9"],min7:["-9b9a9"],dim:[]},G:{major:["355433","320033","320003"],minor:["355333"],5:["355---"],7:["320001","353433"],maj7:["3x443x"],min7:["353333"],dim:[]},Ab:{major:["466544"],minor:["466444"],5:["466---"],7:["464544"],maj7:["4x554x"],min7:["464444"],dim:[]}},examples=[];examples.push([{chords:["D major"],pattern:"x-------"},{chords:["577655"],pattern:"x---"},{chords:["B minor"],pattern:"x---"},{chords:["F# minor"],pattern:"x---"},{chords:["G major"],pattern:"x---xxxx----x-x-"},{chords:["D major"],pattern:"x---"},{chords:["G major"],pattern:"x---"},{chords:["A major"],pattern:"x-x-"}]),examples.push([{chords:["A minor"],pattern:"x---"},{chords:["F major"],pattern:"x---"},{chords:["C major"],pattern:"x---"},{chords:["G major","E minor"],pattern:"x---"}]),examples.push([{chords:["-57775"],pattern:"x---"},{chords:["577655"],pattern:"x-x-"},{chords:["799777"],pattern:"x-x-"},{chords:["355433"],pattern:"x-x-"}]),examples.push([{chords:["C 5"],pattern:"x-x-"},{chords:["G 5"],pattern:"x-x-"},{chords:["F 5"],pattern:"x-x-"},{chords:["F 5"],pattern:"x-x-"}]),Vue.component("tab-bar",{template:'\n  <span>\n    <span v-if="showChordNames" v-for="(chord, index) in bar.chords" style="font-size:11px">\n      {{ index > 0 ? \' | \' : \'\'}}\n      {{!Chord.isNamed(chord) ? Chord.findByShape(chord) : chord}}\n    </span>\n    <span class="tab-line">{{draw(strings.e)}}</span>\n    <span class="tab-line">{{draw(strings.B)}}</span>\n    <span class="tab-line">{{draw(strings.G)}}</span>\n    <span class="tab-line">{{draw(strings.D)}}</span>\n    <span class="tab-line">{{draw(strings.A)}}</span>\n    <span class="tab-line">{{draw(strings.E)}}</span>\n  </span>\n  ',props:["bar","index","showChordNames"],methods:{draw:function(r){return this.convertNamedtoShapes(),"random"===this.bar.pattern.toLowerCase()&&(this.bar.pattern=Pattern.random()),Bar.draw(this.bar.chords,r,this.bar.pattern,this.index)},convertNamedtoShapes:function(){this.bar.chords=this.bar.chords.map(function(r){var n=[],a=_(supportedChords).sortBy(function(r){return r.length}).reverse().value();if(_(a).each(function(a){1===a.length&&(a=" "+a),r.toLowerCase().includes(a)&&(n=Chord.findByName(r))}),n.length){var t=_.random(0,n.length-1);r=n[t]}return r})}},created:function(){this.convertNamedtoShapes()}}),Vue.component("tab",{template:'\n  <div class="tab-section">\n    <span v-for="(chunk, index) in chunked" class="row tab-row">\n      <span v-for="(bar, index) in chunk" class="bar">\n        <tab-bar :index="index" :bar="bar" :showChordNames="showChordNames"></tab-bar>\n      </span>\n    </span>\n  </div>\n  ',props:["progression","showChordNames"],computed:{chunked:function(){return _.chunk(this.progression,constants.BEATS_PER_BAR)}}}),new Vue({el:"#app",data:{json:JSON.stringify(_.sample(examples))},computed:{progression:function(){return JSON.parse(this.json)}},created:function(){this.json=JSON.stringify(JSON.parse(this.json),null,2)}});var editor=new Behave({textarea:document.getElementById("jsonEditor"),tabSize:2,overwrite:!1});